<!-- app/views/chats/show.html.erb -->
<div class="min-h-screen bg-gray-50 flex flex-col items-stretch">
  <!-- チャット全体のラッパー -->
  <div class="w-full flex flex-col flex-1 pb-24 bg-transparent">
    <!-- ヘッダー -->
    <div class="flex items-center justify-between bg-teal-100 rounded-t-lg px-4 py-3 mb-2">
      <!-- 戻るボタン -->
      <%= link_to chats_path, class: "flex items-center text-teal-700 hover:text-teal-900" do %>
        <svg class="w-6 h-6 mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        <span class="hidden sm:inline">一覧へ</span>
      <% end %>
      <!-- AIキャラ名とアイコン -->
      <div class="flex items-center">
        <div class="w-10 h-10 rounded-full bg-gray-200 mr-3"></div>
        <span class="font-bold text-lg text-teal-800"><%= @chat.ai_character.name %></span>
      </div>
      <!-- 設定マーク（モック） -->
      <button class="text-teal-700 hover:text-teal-900 focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M12 6v6l4 2m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </button>
    </div>

    <!-- 日付区切り -->
    <div class="text-center text-xs text-gray-400 my-2">
      <%= @messages.first&.created_at&.strftime('%Y.%m.%d') %>
    </div>

    <!-- メッセージ一覧 -->
    <div class="space-y-4 flex-1 w-full px-2">
      <% @messages.each do |message| %>
        <% if message.user_id.present? %>
          <!-- ユーザーメッセージ（右寄せ） -->
          <div class="flex justify-end items-end">
            <div class="bg-teal-400 text-white rounded-2xl px-4 py-3 max-w-xs text-base shadow">
              <%= message.content %>
            </div>
            <span class="text-xs text-gray-400 ml-2"><%= message.created_at.strftime('%H:%M') %></span>
          </div>
        <% else %>
          <!-- AIメッセージ（左寄せ） -->
          <div class="flex items-end">
            <div class="w-8 h-8 rounded-full bg-gray-200 mr-2"></div>
            <div class="bg-gray-100 text-gray-800 rounded-2xl px-4 py-3 max-w-xs text-base shadow">
              <%= message.content %>
            </div>
            <span class="text-xs text-gray-400 ml-2"><%= message.created_at.strftime('%H:%M') %></span>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- 入力欄 -->
    <div class="fixed bottom-0 left-0 w-full flex justify-center bg-transparent">
      <div class="w-full bg-white border-t py-3 px-4 flex items-center">
        <%= form_with(model: [@chat, Message.new], local: true, class: "flex w-full") do |form| %>
          <%= form.text_field :content, placeholder: "メッセージを入力", class: "flex-1 rounded-full border px-4 py-2 mr-2 focus:outline-none" %>
          <%= form.submit "送信", class: "bg-teal-500 text-white rounded-full px-4 py-2 hover:bg-teal-600 transition" %>
        <% end %>
      </div>
    </div>
  </div>
</div>