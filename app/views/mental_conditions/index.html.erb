<div class="flex items-center justify-between mb-4">
  <h2 class="text-xl font-bold text-text">コンディションの推移</h2>
  <div class="flex items-center space-x-2">
    <%= link_to '日記する', new_diary_path, class: 'btn btn-secondary btn-sm' %>
    <% if @already_recorded_today %>
      <span class="text-xs text-textSub">本日分は記録済み</span>
    <% else %>
      <%= link_to '今日の記録をする', new_mental_condition_path, class: 'btn btn-primary btn-sm' %>
    <% end %>
  </div>
</div>
<div class="mb-8 overflow-x-auto w-full">
  <%= area_chart [
    {name: "こころ", data: @mental_chart},
    {name: "からだ", data: @physical_chart}
  ], height: '300px', library: {
    colors: ['#ef4444', '#fbbf24'],
    spanGaps: true,
    scales: {
      y: {
        min: 0,
        max: 5,
      }
    }
  } %>
</div>

<h2 class="text-xl font-bold mb-4 text-text">記録一覧</h2>
<div class="space-y-4">
  <% @records_by_date.each do |date, records| %>
    <div class="p-4 rounded-xl shadow bg-base-100">
      <div class="font-semibold text-text mb-3"><%= l date, format: :default %></div>
      
      <% if records[:condition] %>
        <div class="mb-3 pb-3 border-b border-gray-200">
          <div class="flex flex-col md:flex-row md:items-center justify-between">
            <div class="flex-1">
              <div class="mt-1">
                <span class="text-red-500 font-semibold">こころ：</span>
                <span class="flex items-center">
                  <%= mental_state_icons(records[:condition].mental_state) %>
                </span>
              </div>
              <div>
                <span class="text-orange-400 font-semibold">からだ：</span>
                <span class="flex items-center">
                  <%= physical_state_icons(records[:condition].physical_state) %>
                </span>
              </div>
            </div>
            <div class="mt-2 md:mt-0 flex space-x-2">
              <%= link_to '編集', edit_mental_condition_path(records[:condition]), class: 'btn btn-primary btn-sm' %>
              <%= link_to '削除', mental_condition_path(records[:condition]), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn bg-red-100 text-red-600 hover:bg-red-200 btn-sm' %>
            </div>
          </div>
        </div>
      <% end %>

      <% if records[:diary] %>
        <div class="flex flex-col md:flex-row md:items-start justify-between">
          <div class="flex-1">
            <div class="text-sm text-textSub mb-1">日記</div>
            <div class="text-text whitespace-pre-wrap"><%= records[:diary].content %></div>
          </div>
          <div class="mt-2 md:mt-0 flex space-x-2">
            <%= link_to '編集', edit_diary_path(records[:diary]), class: 'btn btn-primary btn-sm' %>
            <%= link_to '削除', diary_path(records[:diary]), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn bg-red-100 text-red-600 hover:bg-red-200 btn-sm' %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %> 
</div> 